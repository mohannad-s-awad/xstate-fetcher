{"version":3,"file":"xstate-fetcher.mjs","sources":["../src/Cache.ts","../src/LastEvent.ts","../src/Fetcher.ts","../.yarn/cache/xstate-npm-4.33.2-c714ff5673-6e10bcfe66.zip/node_modules/xstate/lib/_virtual/_tslib.js","../.yarn/cache/xstate-npm-4.33.2-c714ff5673-6e10bcfe66.zip/node_modules/xstate/lib/constants.js","../.yarn/cache/xstate-npm-4.33.2-c714ff5673-6e10bcfe66.zip/node_modules/xstate/lib/environment.js","../.yarn/cache/xstate-npm-4.33.2-c714ff5673-6e10bcfe66.zip/node_modules/xstate/lib/utils.js","../src/Proxy.ts","../src/Integration.ts"],"sourcesContent":["import { type Interpreter, type State } from \"@src/Fetcher\";\n\nconst createCache = () => new Cache();\n\nclass Cache {\n  private _entries: Entry[] = [];\n  private _subscriptions: Subscription[] = [];\n\n  public has(key: Key): boolean {\n    return this._findIndex(key) !== -1;\n  }\n\n  // @todo Disable fetcher if not set to keep active?\n  public set(key: Key, fetcher: Interpreter, options: CacheOptions = {}): void {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex !== -1) {\n      this._remove(entryIndex);\n    }\n\n    const { cacheTime, keepActive } = options;\n    const entry: Entry = {\n      key,\n      fetcher,\n\n      cacheTime: cacheTime ?? Number.POSITIVE_INFINITY,\n\n      activatorsCount: 0,\n      keepActive: keepActive ?? false,\n\n      subscribeFns: [],\n      unsubscribeFn: () => {},\n    };\n\n    entry.subscribeFns = this._filterSubscribeFns(this._subscriptions, entry);\n    entry.unsubscribeFn = fetcher.subscribe((state) =>\n      this._notifySubscribeFns(state, entry)\n    ).unsubscribe;\n\n    this._entries.push(entry);\n  }\n\n  public get(key: Key): ReadonlyEntry {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    return this._entries[entryIndex];\n  }\n\n  public remove(key: Key): void {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    this._remove(entryIndex);\n  }\n\n  public setCacheTime(key: Key, cacheTime: number): void {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    this._setCacheTime(entryIndex, cacheTime);\n  }\n\n  public getCacheTime(key: Key): number {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    const entry = this._entries[entryIndex];\n\n    return entry.cacheTime;\n  }\n\n  public setKeepActive(key: Key, keepActive: boolean): void {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    const entry = this._entries[entryIndex];\n\n    if (keepActive && !entry.keepActive && entry.activatorsCount === 0) {\n      entry.fetcher.send({ type: \"ENABLE\" });\n    }\n\n    entry.keepActive = keepActive;\n  }\n\n  public getKeepActive(key: Key): boolean {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    const entry = this._entries[entryIndex];\n\n    return entry.keepActive;\n  }\n\n  public activate(key: Key): void {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    const entry = this._entries[entryIndex];\n\n    if (++entry.activatorsCount === 1 && entry.cacheTimeout !== undefined) {\n      clearTimeout(entry.cacheTimeout);\n    }\n  }\n\n  public deactivate(key: Key): void {\n    const entryIndex = this._findIndex(key);\n\n    if (entryIndex === -1) {\n      throw new Error(\"Cannot find an entry with this key!\");\n    }\n\n    const entry = this._entries[entryIndex];\n\n    if (--entry.activatorsCount === 0) {\n      if (entry.cacheTime !== Number.POSITIVE_INFINITY) {\n        entry.cacheTimeout = setTimeout(() => {\n          entry.cacheTimeout = undefined;\n\n          this._remove(entryIndex);\n        }, entry.cacheTime);\n      }\n\n      if (!entry.keepActive) {\n        entry.fetcher.send({ type: \"DISABLE\" });\n      }\n    }\n  }\n\n  public filter(key: Key, options?: FilterOptions): ReadonlyEntry[] {\n    return this._entries.filter(\n      (entry) =>\n        this._matchKeys(entry.key, key, options?.isExact) &&\n        (options?.predicateFn === undefined || options.predicateFn(entry))\n    );\n  }\n\n  public batch(key: Key, batchFn: BatchFn, options?: FilterOptions): void {\n    this.filter(key, options).forEach(batchFn);\n  }\n\n  public subscribe(subscriptions: Subscription[]): UnsubscribeFn {\n    this._subscriptions.push(...subscriptions);\n\n    this._entries.forEach((entry) => {\n      entry.subscribeFns.push(\n        ...this._filterSubscribeFns(subscriptions, entry)\n      );\n    });\n\n    return () =>\n      subscriptions.forEach((subscription) => {\n        const subscriptionIndex = this._subscriptions.indexOf(subscription);\n\n        this._subscriptions.splice(subscriptionIndex, 1);\n\n        this._entries.forEach((entry) => {\n          const subscribeFnIndex = entry.subscribeFns.indexOf(\n            subscription.subscribeFn\n          );\n\n          entry.subscribeFns.splice(subscribeFnIndex, 1);\n        });\n      });\n  }\n\n  private _findIndex(key: Key): number {\n    return this._entries.findIndex((entry) =>\n      this._matchKeys(entry.key, key, true)\n    );\n  }\n\n  private _matchKeys(\n    sourceKey: Key,\n    targetKey: Key,\n    isExact: boolean = false\n  ): boolean {\n    if (sourceKey === targetKey) {\n      return true;\n    }\n\n    if (\n      typeof sourceKey === \"object\" &&\n      sourceKey !== null &&\n      typeof targetKey === \"object\" &&\n      targetKey !== null\n    ) {\n      const sourceKeyKeys = Object.keys(sourceKey);\n      const targetKeyKeys = Object.keys(targetKey);\n\n      if (!isExact || sourceKeyKeys.length === targetKeyKeys.length) {\n        return (isExact ? sourceKeyKeys : targetKeyKeys).every((key) =>\n          this._matchKeys(\n            Array.isArray(sourceKey) ? sourceKey[Number(key)] : sourceKey[key],\n            Array.isArray(targetKey) ? targetKey[Number(key)] : targetKey[key],\n            isExact\n          )\n        );\n      }\n    }\n\n    return false;\n  }\n\n  private _setCacheTime(entryIndex: number, cacheTime: number): void {\n    if (cacheTime < 0) {\n      throw new Error(\"Cannot set the cache time to a negative number!\");\n    }\n\n    const entry = this._entries[entryIndex];\n\n    if (entry.cacheTimeout !== undefined) {\n      clearTimeout(entry.cacheTimeout);\n\n      entry.cacheTimeout =\n        cacheTime !== Number.POSITIVE_INFINITY\n          ? setTimeout(\n              () => {\n                entry.cacheTimeout = undefined;\n\n                this._remove(entryIndex);\n              },\n              entry.cacheTime !== Number.POSITIVE_INFINITY\n                ? Math.max(cacheTime - entry.cacheTime, 0)\n                : cacheTime\n            )\n          : undefined;\n    }\n\n    entry.cacheTime = cacheTime;\n  }\n\n  private _filterSubscribeFns(\n    subscriptions: Subscription[],\n    entry: Entry\n  ): SubscribeFn[] {\n    return subscriptions\n      .filter((subscription) =>\n        (subscription.keys ?? [subscription.key]).some(\n          (subscriptionKey) =>\n            this._matchKeys(entry.key, subscriptionKey, subscription.isExact) &&\n            (subscription.predicateFn === undefined ||\n              subscription.predicateFn(entry))\n        )\n      )\n      .map((subscription) => {\n        if (entry.subscribeFns.includes(subscription.subscribeFn)) {\n          throw new Error(\n            \"Cannot reuse a subscribe function with the same entry!\"\n          );\n        }\n\n        return subscription.subscribeFn;\n      });\n  }\n\n  private _notifySubscribeFns(state: State, entry: Entry): void {\n    entry.subscribeFns.forEach((subscribeFn) =>\n      queueMicrotask(() => subscribeFn({ state, entry }))\n    );\n  }\n\n  private _remove(entryIndex: number): void {\n    const entry = this._entries[entryIndex];\n\n    if (entry.activatorsCount !== 0) {\n      throw new Error(\"Cannot remove an active entry!\");\n    }\n\n    if (entry.cacheTimeout !== undefined) {\n      clearTimeout(entry.cacheTimeout);\n\n      entry.cacheTimeout = undefined;\n    }\n\n    entry.unsubscribeFn();\n\n    this._entries.splice(entryIndex, 1);\n  }\n}\n\ntype Entry = {\n  key: Key;\n  fetcher: Interpreter;\n\n  cacheTime: number;\n  cacheTimeout?: Timeout;\n\n  activatorsCount: number;\n  keepActive: boolean;\n\n  subscribeFns: SubscribeFn[];\n  unsubscribeFn: UnsubscribeFn;\n};\n\ntype ReadonlyEntry = Readonly<Omit<Entry, \"cacheTimeout\" | \"unsubscribeFn\">>;\n\ntype CacheOptions = Partial<Pick<Entry, \"cacheTime\" | \"keepActive\">>;\n\ntype Key =\n  | undefined\n  | null\n  | boolean\n  | number\n  | bigint\n  | string\n  | symbol\n  | Key[]\n  | { [key: number | string | symbol]: Key };\n\ntype Timeout = ReturnType<typeof setTimeout>;\n\ntype FilterOptions = {\n  isExact?: boolean;\n  predicateFn?: FilterPredicateFn;\n};\n\ntype FilterPredicateFn = (entry: ReadonlyEntry) => boolean;\ntype BatchFn = (entry: ReadonlyEntry) => void;\n\ntype Subscription = {\n  key?: Key;\n  keys?: Key[];\n  isExact?: boolean;\n  predicateFn?: FilterPredicateFn;\n  subscribeFn: SubscribeFn;\n};\n\ntype SubscribeFn = (parameters: SubscribeFnParameters) => void;\n\ntype SubscribeFnParameters = {\n  state: State;\n  entry: ReadonlyEntry;\n};\n\ntype UnsubscribeFn = () => void;\n\nexport {\n  createCache,\n  Cache,\n  type BatchFn,\n  type Entry,\n  type FilterOptions,\n  type FilterPredicateFn,\n  type Key,\n  type CacheOptions,\n  type ReadonlyEntry,\n  type SubscribeFn,\n  type SubscribeFnParameters,\n  type Subscription,\n  type Timeout,\n  type UnsubscribeFn,\n};\n","import { AnyState } from \"xstate\";\n\nconst getLastEvent = <TEvents>(state: AnyState): TEvents =>\n  state.event.type !== \"\"\n    ? state.event\n    : state.history !== undefined\n    ? getLastEvent(state.history)\n    : undefined;\n\nexport { getLastEvent };\n","import {\n  actions,\n  createMachine,\n  type DoneInvokeEvent,\n  type InterpreterFrom,\n  type StateFrom,\n} from \"xstate\";\n\nimport { getLastEvent } from \"@src/LastEvent\";\n\n// @todo Support typing of data and aborter\nconst createFetcher = (options: FetcherOptions = {}) => {\n  const fetcher = createMachine(\n    {\n      id: \"fetcher\",\n      strict: true,\n      preserveActionOrder: true,\n\n      tsTypes: {} as import(\"./Fetcher.typegen\").Typegen0,\n      schema: {\n        context: {} as Context,\n        events: {} as Event,\n        services: {} as ServiceEvents,\n      },\n      context: {},\n\n      type: \"parallel\",\n      states: {\n        // @todo Support pending request state\n        request: {\n          initial: \"checking\",\n          states: {\n            checking: {\n              always: [\n                {\n                  cond: \"isDisabled\",\n                  target: \"disabled\",\n                },\n                {\n                  cond: \"shouldLoad\",\n                  target: \"loading\",\n                },\n                \"idle\",\n              ],\n            },\n\n            idle: {},\n\n            disabled: {},\n\n            loading: {\n              entry: [\"setCurrentAborter\", \"setCurrentFetch\"],\n\n              invoke: {\n                id: \"currentFetch\",\n                src: \"currentFetch\",\n\n                onDone: {\n                  target: [\"loaded\", \"#fetcher.response.checking\"],\n                  actions: [\n                    \"setData\",\n                    \"setTimestamp\",\n                    \"validate\",\n                    \"clearCurrentAborter\",\n                    \"clearCurrentFetch\",\n                  ],\n                },\n\n                onError: {\n                  target: \"failed\",\n                  actions: [\"clearCurrentAborter\", \"clearCurrentFetch\"],\n                },\n              },\n            },\n\n            loaded: {},\n\n            aborted: {\n              after: {\n                AUTO_RESET_TIME: {\n                  cond: \"isLimitedAutoResetTime\",\n                  target: \"checking\",\n                },\n              },\n            },\n\n            failed: {\n              after: {\n                AUTO_RESET_TIME: {\n                  cond: \"isLimitedAutoResetTime\",\n                  target: \"checking\",\n                },\n              },\n            },\n          },\n\n          on: {\n            LOAD: {\n              target: \"request.checking\",\n              actions: [\n                \"abortCurrentFetch\",\n                \"clearCurrentAborter\",\n                \"clearCurrentFetch\",\n              ],\n            },\n\n            ABORT: {\n              target: \"request.aborted\",\n              actions: [\n                \"abortCurrentFetch\",\n                \"clearCurrentAborter\",\n                \"clearCurrentFetch\",\n              ],\n            },\n          },\n        },\n\n        response: {\n          initial: \"checking\",\n          states: {\n            checking: {\n              always: [\n                {\n                  cond: \"isFresh\",\n                  target: \"fresh\",\n                },\n                {\n                  cond: \"isStale\",\n                  target: \"stale\",\n                },\n                \"none\",\n              ],\n            },\n\n            none: {},\n            stale: {},\n\n            fresh: {\n              after: {\n                //@ todo Prevent unncessary event with new substate?\n                REMAINING_FRESH_TIME: {\n                  cond: \"isLimitedFreshTime\",\n                  target: [\"stale\", \"#fetcher.request.checking\"],\n                },\n              },\n            },\n          },\n        },\n      },\n\n      entry: [\"setDefaultOptions\", \"setData\", \"setTimestamp\"],\n\n      on: {\n        SET_OPTIONS: {\n          target: [\".request.checking\", \".response.checking\"],\n          actions: [\n            \"setOptions\",\n            \"setDefaultOptions\",\n            \"setData\",\n            \"setTimestamp\",\n            \"invalidate\",\n            \"abortCurrentFetch\",\n            \"clearCurrentAborter\",\n            \"clearCurrentFetch\",\n          ],\n        },\n\n        SET_DATA: {\n          target: [\".request.checking\", \".response.checking\"],\n          actions: [\n            \"setData\",\n            \"setTimestamp\",\n            \"validate\",\n            \"abortCurrentFetch\",\n            \"clearCurrentAborter\",\n            \"clearCurrentFetch\",\n          ],\n        },\n\n        SET_TIMESTAMP: {\n          target: [\".request.checking\", \".response.checking\"],\n          actions: [\n            \"setTimestamp\",\n            \"abortCurrentFetch\",\n            \"clearCurrentAborter\",\n            \"clearCurrentFetch\",\n          ],\n        },\n\n        INVALIDATE: {\n          target: [\".request.checking\", \".response.checking\"],\n          actions: [\n            \"invalidate\",\n            \"abortCurrentFetch\",\n            \"clearCurrentAborter\",\n            \"clearCurrentFetch\",\n          ],\n        },\n\n        ENABLE: {\n          target: \".request.checking\",\n          actions: [\n            \"enable\",\n            \"abortCurrentFetch\",\n            \"clearCurrentAborter\",\n            \"clearCurrentFetch\",\n          ],\n        },\n\n        DISABLE: {\n          target: \".request.checking\",\n          actions: [\n            \"disable\",\n            \"abortCurrentFetch\",\n            \"clearCurrentAborter\",\n            \"clearCurrentFetch\",\n          ],\n        },\n\n        RESET: {\n          target: [\".request.checking\", \".response.checking\"],\n          actions: [\n            \"clearData\",\n            \"clearTimestamp\",\n            \"abortCurrentFetch\",\n            \"clearCurrentAborter\",\n            \"clearCurrentFetch\",\n          ],\n        },\n      },\n    },\n    {\n      guards: {\n        isDisabled: (context) => context.isDisabled === true,\n\n        shouldLoad: (context, _event, meta) => {\n          const event = getLastEvent<\n            | Event\n            | { type: \"xstate.init\" }\n            | {\n                type: \"xstate.after(REMAINING_FRESH_TIME)#fetcher.response.fresh\";\n              }\n            | {\n                type: \"xstate.after(AUTO_RESET_TIME)#fetcher.request.aborted\";\n              }\n            | { type: \"xstate.after(AUTO_RESET_TIME)#fetcher.request.failed\" }\n          >(meta.state);\n\n          return (\n            context.fetchFn !== undefined &&\n            (event.type !== \"xstate.init\" || context.loadOnInvoke === true) &&\n            (event.type !==\n              \"xstate.after(REMAINING_FRESH_TIME)#fetcher.response.fresh\" ||\n              context.loadWhenStale === true) &&\n            ((event.type !==\n              \"xstate.after(AUTO_RESET_TIME)#fetcher.request.aborted\" &&\n              event.type !==\n                \"xstate.after(AUTO_RESET_TIME)#fetcher.request.failed\") ||\n              context.loadOnAutoReset === true) &&\n            (event.type !== \"INVALIDATE\" ||\n              context.loadOnInvalidate === true) &&\n            (event.type !== \"ENABLE\" || context.loadOnEnable === true) &&\n            (event.type !== \"RESET\" || context.loadOnReset === true) &&\n            (context.data === undefined ||\n              Date.now() - context.timestamp! > context.freshTime! ||\n              (event.type === \"LOAD\" && (event.data?.refresh ?? false)) ||\n              (event.type === \"ENABLE\" && (event.data?.refresh ?? false)) ||\n              context.isInvalid === true ||\n              context.currentFetch !== undefined)\n          );\n        },\n\n        isFresh: (context) =>\n          context.data !== undefined &&\n          Date.now() - context.timestamp! <= context.freshTime! &&\n          context.isInvalid === false,\n\n        isStale: (context) =>\n          (context.data !== undefined &&\n            Date.now() - context.timestamp! > context.freshTime!) ||\n          context.isInvalid === true,\n\n        isLimitedFreshTime: (context) =>\n          context.freshTime !== Number.POSITIVE_INFINITY,\n\n        isLimitedAutoResetTime: (context) =>\n          context.autoResetTime !== Number.POSITIVE_INFINITY,\n      },\n\n      delays: {\n        REMAINING_FRESH_TIME: (context) =>\n          context.freshTime !== Number.POSITIVE_INFINITY\n            ? Math.max(\n                context.freshTime! - (Date.now() - context.timestamp!),\n                0\n              )\n            : 0,\n\n        AUTO_RESET_TIME: (context) =>\n          context.autoResetTime !== Number.POSITIVE_INFINITY\n            ? context.autoResetTime!\n            : 0,\n      },\n\n      actions: {\n        setDefaultOptions: actions.assign((context) => ({\n          type: context.type ?? \"QUERY\",\n\n          timestampFn: context.timestampFn ?? (() => Date.now()),\n          aborterFn: context.aborterFn ?? (() => new AbortController()),\n\n          isInvalid: context.isInvalid ?? false,\n          isDisabled: context.isDisabled ?? false,\n\n          freshTime: context.freshTime ?? Number.POSITIVE_INFINITY,\n          autoResetTime: context.autoResetTime ?? Number.POSITIVE_INFINITY,\n\n          loadOnInvoke: context.loadOnInvoke ?? context.type !== \"MUTATION\",\n          loadOnInvalidate:\n            context.loadOnInvalidate ?? context.type !== \"MUTATION\",\n          loadOnEnable: context.loadOnEnable ?? context.type !== \"MUTATION\",\n          loadOnReset: context.loadOnReset ?? context.type !== \"MUTATION\",\n          loadOnAutoReset:\n            context.loadOnAutoReset ?? context.type !== \"MUTATION\",\n          loadWhenStale: context.loadWhenStale ?? context.type !== \"MUTATION\",\n        })),\n\n        // @todo Check validity of provided option values\n        setOptions: actions.assign((context, event) => ({\n          ...context,\n          ...event.data,\n        })),\n\n        // @todo Ignore new data if it has older timestamp\n        // @todo Merge new data with old one using structural equality\n        setData: actions.assign((context, event) => ({\n          data:\n            event.type === \"xstate.init\"\n              ? context.initialData\n              : event.type === \"done.invoke.currentFetch\"\n              ? event.data.data\n              : event.type === \"SET_OPTIONS\" && context.data === undefined\n              ? context.initialData\n              : event.type === \"SET_DATA\"\n              ? event.data\n              : context.data,\n        })),\n\n        clearData: actions.assign((context, event) => ({\n          data: event.data?.clear ?? false ? undefined : context.data,\n        })),\n\n        setTimestamp: actions.assign((context, event, meta) => ({\n          timestamp:\n            event.type === \"xstate.init\" && context.data !== undefined\n              ? context.initialTimestamp ?? Date.now()\n              : event.type === \"done.invoke.currentFetch\"\n              ? context.data === undefined\n                ? undefined\n                : context.timestampFn!(event.data)\n              : event.type === \"SET_OPTIONS\" &&\n                meta.state!.context.data === undefined\n              ? context.initialTimestamp ?? Date.now()\n              : event.type === \"SET_DATA\"\n              ? context.data === undefined\n                ? undefined\n                : event.data.timestamp ?? Date.now()\n              : event.type === \"SET_TIMESTAMP\" && context.data !== undefined\n              ? event.data.timestamp\n              : context.timestamp,\n        })),\n\n        clearTimestamp: actions.assign((context, event) => ({\n          timestamp: event.data?.clear ?? false ? undefined : context.timestamp,\n        })),\n\n        validate: actions.assign((_context) => ({\n          isInvalid: false,\n        })),\n\n        invalidate: actions.assign((context, event, meta) => ({\n          isInvalid:\n            (event.type === \"SET_OPTIONS\" &&\n              context.fetchFn !== meta.state!.context.fetchFn) ||\n            event.type === \"INVALIDATE\"\n              ? true\n              : context.isInvalid,\n        })),\n\n        enable: actions.assign((_context) => ({\n          isDisabled: false,\n        })),\n\n        disable: actions.assign((_context) => ({\n          isDisabled: false,\n        })),\n\n        setCurrentAborter: actions.assign((context) => ({\n          currentAborter:\n            context.aborterFn !== false && context.currentAborter === undefined\n              ? context.aborterFn!()\n              : context.currentAborter,\n        })),\n\n        clearCurrentAborter: actions.assign((context, event, meta) => ({\n          currentAborter:\n            event.type === \"done.invoke.currentFetch\" ||\n            event.type === \"error.platform.currentFetch\" ||\n            (event.type === \"SET_OPTIONS\" &&\n              (event.data.abort === true ||\n                (event.data.abort === undefined &&\n                  context.fetchFn !== meta.state!.context.fetchFn))) ||\n            (event.type === \"SET_DATA\" && event.data.abort !== false) ||\n            (event.type === \"SET_TIMESTAMP\" && event.data.abort === true) ||\n            event.type === \"INVALIDATE\" ||\n            (event.type === \"ENABLE\" && (event.data?.abort ?? false)) ||\n            (event.type === \"DISABLE\" && (event.data?.abort ?? false)) ||\n            (event.type === \"LOAD\" && (event.data?.abort ?? false)) ||\n            event.type === \"ABORT\" ||\n            event.type === \"RESET\"\n              ? undefined\n              : context.currentAborter,\n        })),\n\n        setCurrentFetch: actions.assign((context) => ({\n          currentFetch:\n            context.currentFetch === undefined\n              ? context.fetchFn!({ aborter: context.currentAborter! })\n              : context.currentFetch,\n        })),\n\n        clearCurrentFetch: actions.assign((context, event, meta) => ({\n          currentFetch:\n            event.type === \"done.invoke.currentFetch\" ||\n            event.type === \"error.platform.currentFetch\" ||\n            (event.type === \"SET_OPTIONS\" &&\n              (event.data.abort === true ||\n                (event.data.abort === undefined &&\n                  context.fetchFn !== meta.state!.context.fetchFn))) ||\n            (event.type === \"SET_DATA\" && event.data.abort !== false) ||\n            (event.type === \"SET_TIMESTAMP\" && event.data.abort === true) ||\n            event.type === \"INVALIDATE\" ||\n            (event.type === \"ENABLE\" && (event.data?.abort ?? false)) ||\n            (event.type === \"DISABLE\" && (event.data?.abort ?? false)) ||\n            (event.type === \"LOAD\" && (event.data?.abort ?? false)) ||\n            event.type === \"ABORT\" ||\n            event.type === \"RESET\"\n              ? undefined\n              : context.currentFetch,\n        })),\n\n        abortCurrentFetch: (context, event, meta) => {\n          if (\n            context.currentAborter !== undefined &&\n            ((event.type === \"SET_OPTIONS\" &&\n              (event.data.abort === true ||\n                (event.data.abort === undefined &&\n                  context.fetchFn !== meta.state!.context.fetchFn))) ||\n              (event.type === \"SET_DATA\" && event.data.abort !== false) ||\n              (event.type === \"SET_TIMESTAMP\" && event.data.abort === true) ||\n              event.type === \"INVALIDATE\" ||\n              (event.type === \"ENABLE\" && (event.data?.abort ?? false)) ||\n              (event.type === \"DISABLE\" && (event.data?.abort ?? false)) ||\n              (event.type === \"LOAD\" && (event.data?.abort ?? false)) ||\n              event.type === \"ABORT\" ||\n              event.type === \"RESET\")\n          ) {\n            context.currentAborter!.abort(event);\n          }\n        },\n      },\n\n      services: {\n        currentFetch: (context) => () => context.currentFetch,\n      },\n    }\n  );\n\n  return fetcher.withContext({\n    ...fetcher.context,\n    ...options,\n  });\n};\n\ntype Machine = ReturnType<typeof createFetcher>;\ntype Interpreter = InterpreterFrom<Machine>;\ntype State = StateFrom<Machine>;\n\n/*\n@todo Add options for:\n  keepPreviousData\n  retrying\n  loadOnInterval\n  loadOnRefocus\n  loadOnReconnect\n*/\ntype Context = {\n  type?: Type;\n\n  fetchFn?: FetchFn;\n  timestampFn?: TimestampFn;\n  aborterFn?: AborterFn | false;\n\n  currentFetch?: Promise<any>;\n  currentAborter?: Aborter;\n\n  data?: any;\n  initialData?: any;\n  placeholderData?: any;\n\n  timestamp?: number;\n  initialTimestamp?: number;\n\n  isInvalid?: boolean;\n  isDisabled?: boolean;\n\n  freshTime?: number;\n  autoResetTime?: number;\n\n  loadOnInvoke?: boolean;\n  loadOnInvalidate?: boolean;\n  loadOnEnable?: boolean;\n  loadOnReset?: boolean;\n  loadOnAutoReset?: boolean;\n  loadWhenStale?: boolean;\n};\n\ntype FetcherOptions = Partial<\n  Pick<\n    Context,\n    | \"type\"\n    | \"fetchFn\"\n    | \"timestampFn\"\n    | \"aborterFn\"\n    | \"initialData\"\n    | \"initialTimestamp\"\n    | \"placeholderData\"\n    | \"isInvalid\"\n    | \"isDisabled\"\n    | \"freshTime\"\n    | \"autoResetTime\"\n    | \"loadOnInvoke\"\n    | \"loadOnInvalidate\"\n    | \"loadOnEnable\"\n    | \"loadOnReset\"\n    | \"loadOnAutoReset\"\n    | \"loadWhenStale\"\n  >\n>;\n\ntype Type = \"QUERY\" | \"MUTATION\";\n\ntype FetchFn = (parameters: { aborter: Aborter }) => Promise<any>;\ntype TimestampFn = (data: any) => number;\ntype AborterFn = () => Aborter;\n\ntype Aborter = {\n  abort: (reason: Event) => void;\n  signal: any;\n};\n\ntype Event =\n  | SetOptionsEvent\n  | SetDataEvent\n  | SetTimestampEvent\n  | InvalidateEvent\n  | EnableEvent\n  | DisableEvent\n  | LoadEvent\n  | AbortEvent\n  | ResetEvent;\n\ntype SetOptionsEvent = {\n  type: \"SET_OPTIONS\";\n  data: FetcherOptions & { abort?: boolean };\n};\n\ntype SetDataEvent = {\n  type: \"SET_DATA\";\n  data: {\n    data: any;\n    timestamp?: number;\n    abort?: boolean;\n  };\n};\n\ntype SetTimestampEvent = {\n  type: \"SET_TIMESTAMP\";\n  data: {\n    timestamp: number;\n    abort?: boolean;\n  };\n};\n\ntype InvalidateEvent = { type: \"INVALIDATE\" };\n\ntype EnableEvent = {\n  type: \"ENABLE\";\n  data?: {\n    abort?: boolean;\n    refresh?: boolean;\n  };\n};\n\ntype DisableEvent = {\n  type: \"DISABLE\";\n  data?: { abort?: boolean };\n};\n\ntype LoadEvent = {\n  type: \"LOAD\";\n  data?: {\n    abort?: boolean;\n    refresh?: boolean;\n  };\n};\n\ntype AbortEvent = {\n  type: \"ABORT\";\n  data?: { reason?: any };\n};\n\ntype ResetEvent = {\n  type: \"RESET\";\n  data?: { clear?: boolean };\n};\n\ntype ServiceEvents = { currentFetch: CurrentFetchServiceEvent };\ntype CurrentFetchServiceEvent = DoneInvokeEvent<{ data: any }>;\n\nexport {\n  createFetcher,\n  type AborterFn,\n  type Aborter,\n  type Context,\n  type Event,\n  type FetchFn,\n  type FetcherOptions,\n  type Interpreter,\n  type Machine,\n  type State,\n  type TimestampFn,\n  type Type,\n};\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nexports.__assign = function() {\r\n    exports.__assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return exports.__assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nfunction __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nfunction __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\n\nexports.__read = __read;\nexports.__rest = __rest;\nexports.__spreadArray = __spreadArray;\nexports.__values = __values;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar STATE_DELIMITER = '.';\nvar EMPTY_ACTIVITY_MAP = {};\nvar DEFAULT_GUARD_TYPE = 'xstate.guard';\nvar TARGETLESS_KEY = '';\n\nexports.DEFAULT_GUARD_TYPE = DEFAULT_GUARD_TYPE;\nexports.EMPTY_ACTIVITY_MAP = EMPTY_ACTIVITY_MAP;\nexports.STATE_DELIMITER = STATE_DELIMITER;\nexports.TARGETLESS_KEY = TARGETLESS_KEY;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar IS_PRODUCTION = process.env.NODE_ENV === 'production';\n\nexports.IS_PRODUCTION = IS_PRODUCTION;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar _tslib = require('./_virtual/_tslib.js');\nvar constants = require('./constants.js');\nvar environment = require('./environment.js');\n\nvar _a;\nfunction keys(value) {\n  return Object.keys(value);\n}\nfunction matchesState(parentStateId, childStateId, delimiter) {\n  if (delimiter === void 0) {\n    delimiter = constants.STATE_DELIMITER;\n  }\n\n  var parentStateValue = toStateValue(parentStateId, delimiter);\n  var childStateValue = toStateValue(childStateId, delimiter);\n\n  if (isString(childStateValue)) {\n    if (isString(parentStateValue)) {\n      return childStateValue === parentStateValue;\n    } // Parent more specific than child\n\n\n    return false;\n  }\n\n  if (isString(parentStateValue)) {\n    return parentStateValue in childStateValue;\n  }\n\n  return Object.keys(parentStateValue).every(function (key) {\n    if (!(key in childStateValue)) {\n      return false;\n    }\n\n    return matchesState(parentStateValue[key], childStateValue[key]);\n  });\n}\nfunction getEventType(event) {\n  try {\n    return isString(event) || typeof event === 'number' ? \"\".concat(event) : event.type;\n  } catch (e) {\n    throw new Error('Events must be strings or objects with a string event.type property.');\n  }\n}\nfunction getActionType(action) {\n  try {\n    return isString(action) || typeof action === 'number' ? \"\".concat(action) : isFunction(action) ? action.name : action.type;\n  } catch (e) {\n    throw new Error('Actions must be strings or objects with a string action.type property.');\n  }\n}\nfunction toStatePath(stateId, delimiter) {\n  try {\n    if (isArray(stateId)) {\n      return stateId;\n    }\n\n    return stateId.toString().split(delimiter);\n  } catch (e) {\n    throw new Error(\"'\".concat(stateId, \"' is not a valid state path.\"));\n  }\n}\nfunction isStateLike(state) {\n  return typeof state === 'object' && 'value' in state && 'context' in state && 'event' in state && '_event' in state;\n}\nfunction toStateValue(stateValue, delimiter) {\n  if (isStateLike(stateValue)) {\n    return stateValue.value;\n  }\n\n  if (isArray(stateValue)) {\n    return pathToStateValue(stateValue);\n  }\n\n  if (typeof stateValue !== 'string') {\n    return stateValue;\n  }\n\n  var statePath = toStatePath(stateValue, delimiter);\n  return pathToStateValue(statePath);\n}\nfunction pathToStateValue(statePath) {\n  if (statePath.length === 1) {\n    return statePath[0];\n  }\n\n  var value = {};\n  var marker = value;\n\n  for (var i = 0; i < statePath.length - 1; i++) {\n    if (i === statePath.length - 2) {\n      marker[statePath[i]] = statePath[i + 1];\n    } else {\n      marker[statePath[i]] = {};\n      marker = marker[statePath[i]];\n    }\n  }\n\n  return value;\n}\nfunction mapValues(collection, iteratee) {\n  var result = {};\n  var collectionKeys = Object.keys(collection);\n\n  for (var i = 0; i < collectionKeys.length; i++) {\n    var key = collectionKeys[i];\n    result[key] = iteratee(collection[key], key, collection, i);\n  }\n\n  return result;\n}\nfunction mapFilterValues(collection, iteratee, predicate) {\n  var e_1, _a;\n\n  var result = {};\n\n  try {\n    for (var _b = _tslib.__values(Object.keys(collection)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var item = collection[key];\n\n      if (!predicate(item)) {\n        continue;\n      }\n\n      result[key] = iteratee(item, key, collection);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return result;\n}\n/**\r\n * Retrieves a value at the given path.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\nvar path = function (props) {\n  return function (object) {\n    var e_2, _a;\n\n    var result = object;\n\n    try {\n      for (var props_1 = _tslib.__values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {\n        var prop = props_1_1.value;\n        result = result[prop];\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return result;\n  };\n};\n/**\r\n * Retrieves a value at the given path via the nested accessor prop.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\nfunction nestedPath(props, accessorProp) {\n  return function (object) {\n    var e_3, _a;\n\n    var result = object;\n\n    try {\n      for (var props_2 = _tslib.__values(props), props_2_1 = props_2.next(); !props_2_1.done; props_2_1 = props_2.next()) {\n        var prop = props_2_1.value;\n        result = result[accessorProp][prop];\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (props_2_1 && !props_2_1.done && (_a = props_2.return)) _a.call(props_2);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    return result;\n  };\n}\nfunction toStatePaths(stateValue) {\n  if (!stateValue) {\n    return [[]];\n  }\n\n  if (isString(stateValue)) {\n    return [[stateValue]];\n  }\n\n  var result = flatten(Object.keys(stateValue).map(function (key) {\n    var subStateValue = stateValue[key];\n\n    if (typeof subStateValue !== 'string' && (!subStateValue || !Object.keys(subStateValue).length)) {\n      return [[key]];\n    }\n\n    return toStatePaths(stateValue[key]).map(function (subPath) {\n      return [key].concat(subPath);\n    });\n  }));\n  return result;\n}\nfunction pathsToStateValue(paths) {\n  var e_4, _a;\n\n  var result = {};\n\n  if (paths && paths.length === 1 && paths[0].length === 1) {\n    return paths[0][0];\n  }\n\n  try {\n    for (var paths_1 = _tslib.__values(paths), paths_1_1 = paths_1.next(); !paths_1_1.done; paths_1_1 = paths_1.next()) {\n      var currentPath = paths_1_1.value;\n      var marker = result; // tslint:disable-next-line:prefer-for-of\n\n      for (var i = 0; i < currentPath.length; i++) {\n        var subPath = currentPath[i];\n\n        if (i === currentPath.length - 2) {\n          marker[subPath] = currentPath[i + 1];\n          break;\n        }\n\n        marker[subPath] = marker[subPath] || {};\n        marker = marker[subPath];\n      }\n    }\n  } catch (e_4_1) {\n    e_4 = {\n      error: e_4_1\n    };\n  } finally {\n    try {\n      if (paths_1_1 && !paths_1_1.done && (_a = paths_1.return)) _a.call(paths_1);\n    } finally {\n      if (e_4) throw e_4.error;\n    }\n  }\n\n  return result;\n}\nfunction flatten(array) {\n  var _a;\n\n  return (_a = []).concat.apply(_a, _tslib.__spreadArray([], _tslib.__read(array), false));\n}\nfunction toArrayStrict(value) {\n  if (isArray(value)) {\n    return value;\n  }\n\n  return [value];\n}\nfunction toArray(value) {\n  if (value === undefined) {\n    return [];\n  }\n\n  return toArrayStrict(value);\n}\nfunction mapContext(mapper, context, _event) {\n  var e_5, _a;\n\n  if (isFunction(mapper)) {\n    return mapper(context, _event.data);\n  }\n\n  var result = {};\n\n  try {\n    for (var _b = _tslib.__values(Object.keys(mapper)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var subMapper = mapper[key];\n\n      if (isFunction(subMapper)) {\n        result[key] = subMapper(context, _event.data);\n      } else {\n        result[key] = subMapper;\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return result;\n}\nfunction isBuiltInEvent(eventType) {\n  return /^(done|error)\\./.test(eventType);\n}\nfunction isPromiseLike(value) {\n  if (value instanceof Promise) {\n    return true;\n  } // Check if shape matches the Promise/A+ specification for a \"thenable\".\n\n\n  if (value !== null && (isFunction(value) || typeof value === 'object') && isFunction(value.then)) {\n    return true;\n  }\n\n  return false;\n}\nfunction isBehavior(value) {\n  return value !== null && typeof value === 'object' && 'transition' in value && typeof value.transition === 'function';\n}\nfunction partition(items, predicate) {\n  var e_6, _a;\n\n  var _b = _tslib.__read([[], []], 2),\n      truthy = _b[0],\n      falsy = _b[1];\n\n  try {\n    for (var items_1 = _tslib.__values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {\n      var item = items_1_1.value;\n\n      if (predicate(item)) {\n        truthy.push(item);\n      } else {\n        falsy.push(item);\n      }\n    }\n  } catch (e_6_1) {\n    e_6 = {\n      error: e_6_1\n    };\n  } finally {\n    try {\n      if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);\n    } finally {\n      if (e_6) throw e_6.error;\n    }\n  }\n\n  return [truthy, falsy];\n}\nfunction updateHistoryStates(hist, stateValue) {\n  return mapValues(hist.states, function (subHist, key) {\n    if (!subHist) {\n      return undefined;\n    }\n\n    var subStateValue = (isString(stateValue) ? undefined : stateValue[key]) || (subHist ? subHist.current : undefined);\n\n    if (!subStateValue) {\n      return undefined;\n    }\n\n    return {\n      current: subStateValue,\n      states: updateHistoryStates(subHist, subStateValue)\n    };\n  });\n}\nfunction updateHistoryValue(hist, stateValue) {\n  return {\n    current: stateValue,\n    states: updateHistoryStates(hist, stateValue)\n  };\n}\nfunction updateContext(context, _event, assignActions, state) {\n  if (!environment.IS_PRODUCTION) {\n    exports.warn(!!context, 'Attempting to update undefined context');\n  }\n\n  var updatedContext = context ? assignActions.reduce(function (acc, assignAction) {\n    var e_7, _a;\n\n    var assignment = assignAction.assignment;\n    var meta = {\n      state: state,\n      action: assignAction,\n      _event: _event\n    };\n    var partialUpdate = {};\n\n    if (isFunction(assignment)) {\n      partialUpdate = assignment(acc, _event.data, meta);\n    } else {\n      try {\n        for (var _b = _tslib.__values(Object.keys(assignment)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var key = _c.value;\n          var propAssignment = assignment[key];\n          partialUpdate[key] = isFunction(propAssignment) ? propAssignment(acc, _event.data, meta) : propAssignment;\n        }\n      } catch (e_7_1) {\n        e_7 = {\n          error: e_7_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_7) throw e_7.error;\n        }\n      }\n    }\n\n    return Object.assign({}, acc, partialUpdate);\n  }, context) : context;\n  return updatedContext;\n} // tslint:disable-next-line:no-empty\n\nexports.warn = function () {};\n\nif (!environment.IS_PRODUCTION) {\n  exports.warn = function (condition, message) {\n    var error = condition instanceof Error ? condition : undefined;\n\n    if (!error && condition) {\n      return;\n    }\n\n    if (console !== undefined) {\n      var args = [\"Warning: \".concat(message)];\n\n      if (error) {\n        args.push(error);\n      } // tslint:disable-next-line:no-console\n\n\n      console.warn.apply(console, args);\n    }\n  };\n}\nfunction isArray(value) {\n  return Array.isArray(value);\n} // tslint:disable-next-line:ban-types\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\nfunction isString(value) {\n  return typeof value === 'string';\n}\nfunction toGuard(condition, guardMap) {\n  if (!condition) {\n    return undefined;\n  }\n\n  if (isString(condition)) {\n    return {\n      type: constants.DEFAULT_GUARD_TYPE,\n      name: condition,\n      predicate: guardMap ? guardMap[condition] : undefined\n    };\n  }\n\n  if (isFunction(condition)) {\n    return {\n      type: constants.DEFAULT_GUARD_TYPE,\n      name: condition.name,\n      predicate: condition\n    };\n  }\n\n  return condition;\n}\nfunction isObservable(value) {\n  try {\n    return 'subscribe' in value && isFunction(value.subscribe);\n  } catch (e) {\n    return false;\n  }\n}\nvar symbolObservable = /*#__PURE__*/function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}(); // TODO: to be removed in v5, left it out just to minimize the scope of the change and maintain compatibility with older versions of integration paackages\n\nvar interopSymbols = (_a = {}, _a[symbolObservable] = function () {\n  return this;\n}, _a[Symbol.observable] = function () {\n  return this;\n}, _a);\nfunction isMachine(value) {\n  return !!value && '__xstatenode' in value;\n}\nfunction isActor(value) {\n  return !!value && typeof value.send === 'function';\n}\nvar uniqueId = /*#__PURE__*/function () {\n  var currentId = 0;\n  return function () {\n    currentId++;\n    return currentId.toString(16);\n  };\n}();\nfunction toEventObject(event, payload // id?: TEvent['type']\n) {\n  if (isString(event) || typeof event === 'number') {\n    return _tslib.__assign({\n      type: event\n    }, payload);\n  }\n\n  return event;\n}\nfunction toSCXMLEvent(event, scxmlEvent) {\n  if (!isString(event) && '$$type' in event && event.$$type === 'scxml') {\n    return event;\n  }\n\n  var eventObject = toEventObject(event);\n  return _tslib.__assign({\n    name: eventObject.type,\n    data: eventObject,\n    $$type: 'scxml',\n    type: 'external'\n  }, scxmlEvent);\n}\nfunction toTransitionConfigArray(event, configLike) {\n  var transitions = toArrayStrict(configLike).map(function (transitionLike) {\n    if (typeof transitionLike === 'undefined' || typeof transitionLike === 'string' || isMachine(transitionLike)) {\n      return {\n        target: transitionLike,\n        event: event\n      };\n    }\n\n    return _tslib.__assign(_tslib.__assign({}, transitionLike), {\n      event: event\n    });\n  });\n  return transitions;\n}\nfunction normalizeTarget(target) {\n  if (target === undefined || target === constants.TARGETLESS_KEY) {\n    return undefined;\n  }\n\n  return toArray(target);\n}\nfunction reportUnhandledExceptionOnInvocation(originalError, currentError, id) {\n  if (!environment.IS_PRODUCTION) {\n    var originalStackTrace = originalError.stack ? \" Stacktrace was '\".concat(originalError.stack, \"'\") : '';\n\n    if (originalError === currentError) {\n      // tslint:disable-next-line:no-console\n      console.error(\"Missing onError handler for invocation '\".concat(id, \"', error was '\").concat(originalError, \"'.\").concat(originalStackTrace));\n    } else {\n      var stackTrace = currentError.stack ? \" Stacktrace was '\".concat(currentError.stack, \"'\") : ''; // tslint:disable-next-line:no-console\n\n      console.error(\"Missing onError handler and/or unhandled exception/promise rejection for invocation '\".concat(id, \"'. \") + \"Original error: '\".concat(originalError, \"'. \").concat(originalStackTrace, \" Current error is '\").concat(currentError, \"'.\").concat(stackTrace));\n    }\n  }\n}\nfunction evaluateGuard(machine, guard, context, _event, state) {\n  var guards = machine.options.guards;\n  var guardMeta = {\n    state: state,\n    cond: guard,\n    _event: _event\n  }; // TODO: do not hardcode!\n\n  if (guard.type === constants.DEFAULT_GUARD_TYPE) {\n    return ((guards === null || guards === void 0 ? void 0 : guards[guard.name]) || guard.predicate)(context, _event.data, guardMeta);\n  }\n\n  var condFn = guards === null || guards === void 0 ? void 0 : guards[guard.type];\n\n  if (!condFn) {\n    throw new Error(\"Guard '\".concat(guard.type, \"' is not implemented on machine '\").concat(machine.id, \"'.\"));\n  }\n\n  return condFn(context, _event.data, guardMeta);\n}\nfunction toInvokeSource(src) {\n  if (typeof src === 'string') {\n    return {\n      type: src\n    };\n  }\n\n  return src;\n}\nfunction toObserver(nextHandler, errorHandler, completionHandler) {\n  var noop = function () {};\n\n  var isObserver = typeof nextHandler === 'object';\n  var self = isObserver ? nextHandler : null;\n  return {\n    next: ((isObserver ? nextHandler.next : nextHandler) || noop).bind(self),\n    error: ((isObserver ? nextHandler.error : errorHandler) || noop).bind(self),\n    complete: ((isObserver ? nextHandler.complete : completionHandler) || noop).bind(self)\n  };\n}\nfunction createInvokeId(stateNodeId, index) {\n  return \"\".concat(stateNodeId, \":invocation[\").concat(index, \"]\");\n}\n\nexports.createInvokeId = createInvokeId;\nexports.evaluateGuard = evaluateGuard;\nexports.flatten = flatten;\nexports.getActionType = getActionType;\nexports.getEventType = getEventType;\nexports.interopSymbols = interopSymbols;\nexports.isActor = isActor;\nexports.isArray = isArray;\nexports.isBehavior = isBehavior;\nexports.isBuiltInEvent = isBuiltInEvent;\nexports.isFunction = isFunction;\nexports.isMachine = isMachine;\nexports.isObservable = isObservable;\nexports.isPromiseLike = isPromiseLike;\nexports.isStateLike = isStateLike;\nexports.isString = isString;\nexports.keys = keys;\nexports.mapContext = mapContext;\nexports.mapFilterValues = mapFilterValues;\nexports.mapValues = mapValues;\nexports.matchesState = matchesState;\nexports.nestedPath = nestedPath;\nexports.normalizeTarget = normalizeTarget;\nexports.partition = partition;\nexports.path = path;\nexports.pathToStateValue = pathToStateValue;\nexports.pathsToStateValue = pathsToStateValue;\nexports.reportUnhandledExceptionOnInvocation = reportUnhandledExceptionOnInvocation;\nexports.symbolObservable = symbolObservable;\nexports.toArray = toArray;\nexports.toArrayStrict = toArrayStrict;\nexports.toEventObject = toEventObject;\nexports.toGuard = toGuard;\nexports.toInvokeSource = toInvokeSource;\nexports.toObserver = toObserver;\nexports.toSCXMLEvent = toSCXMLEvent;\nexports.toStatePath = toStatePath;\nexports.toStatePaths = toStatePaths;\nexports.toStateValue = toStateValue;\nexports.toTransitionConfigArray = toTransitionConfigArray;\nexports.uniqueId = uniqueId;\nexports.updateContext = updateContext;\nexports.updateHistoryStates = updateHistoryStates;\nexports.updateHistoryValue = updateHistoryValue;\n","import {\n  createMachine,\n  interpret,\n  type AnyInterpreter,\n  type AnyEventObject,\n  type AnyState,\n  type AnyStateMachine,\n  type InvokeCallback,\n  type Subscription,\n} from \"xstate\";\nimport { isMachine } from \"xstate/lib/utils\";\n\nimport { getLastEvent } from \"@src/LastEvent\";\n\nconst interceptor = createMachine({\n  id: \"interceptor\",\n  strict: false,\n  preserveActionOrder: true,\n});\n\nconst createProxy = (\n  machineOrInterpreter: AnyStateMachine | AnyInterpreter,\n  options: ProxyOptions = {}\n): Proxy => {\n  const proxy: Proxy = (sendBack, on) => {\n    const interpreter = isMachine(machineOrInterpreter)\n      ? interpret(machineOrInterpreter)\n      : machineOrInterpreter;\n    const { mapFn, autoStart, autoStop, cleanFn } = options;\n\n    proxy.interpreter = interpreter;\n\n    if (interpreter.parent !== undefined) {\n      if ((interpreter.parent.machine as AnyStateMachine) !== interceptor) {\n        throw new Error(\n          \"Cannot proxy a machine/interpreter with an assigned parent!\"\n        );\n      }\n    } else {\n      interpreter.parent = interpret(interceptor).start() as AnyInterpreter;\n    }\n\n    on((event) => interpreter.send(event));\n\n    let interpreterUnsubscribeFn: Subscription[\"unsubscribe\"];\n    let interceptorUnsubscribeFn: Subscription[\"unsubscribe\"];\n    let isInterceptorInitialized = false;\n\n    if (mapFn !== undefined) {\n      interpreterUnsubscribeFn = interpreter.subscribe((state) => {\n        const mappedEvent = mapFn({ state, event: getLastEvent(state) });\n\n        if (mappedEvent !== undefined) {\n          sendBack(mappedEvent);\n        }\n      }).unsubscribe;\n\n      interceptorUnsubscribeFn = interpreter.parent.subscribe((state) => {\n        if (isInterceptorInitialized) {\n          const mappedEvent = mapFn({\n            state: interpreter.state,\n            event: getLastEvent(state),\n          });\n\n          if (mappedEvent !== undefined) {\n            sendBack(mappedEvent);\n          }\n        }\n\n        isInterceptorInitialized = true;\n      }).unsubscribe;\n    }\n\n    if (\n      autoStart === true ||\n      (autoStart === undefined && isMachine(machineOrInterpreter))\n    ) {\n      interpreter.start();\n    }\n\n    return () => {\n      if (cleanFn !== undefined) {\n        cleanFn();\n      }\n\n      if (mapFn !== undefined) {\n        interpreterUnsubscribeFn();\n        interceptorUnsubscribeFn();\n      }\n\n      if (\n        autoStop === true ||\n        (autoStart === undefined && isMachine(machineOrInterpreter))\n      ) {\n        interpreter.stop();\n      }\n    };\n  };\n\n  return proxy;\n};\n\ntype Proxy = InvokeCallback & { interpreter?: AnyInterpreter };\n\ntype ProxyOptions = {\n  mapFn?: MapFn;\n  cleanFn?: CleanFn;\n\n  autoStart?: boolean;\n  autoStop?: boolean;\n};\n\ntype MapFn = (parameters: MapFnParameters) => AnyEventObject | void;\n\ntype MapFnParameters = {\n  state: AnyState;\n  event: AnyEventObject;\n};\n\ntype CleanFn = () => void;\n\nexport { createProxy, type Proxy, type ProxyOptions };\n","import { interpret } from \"xstate\";\n\nimport {\n  Cache,\n  type Key,\n  type CacheOptions,\n  type Subscription,\n  type SubscribeFnParameters,\n} from \"@src/Cache\";\n\nimport {\n  createFetcher,\n  type Event,\n  type Interpreter,\n  type FetcherOptions,\n} from \"@src/Fetcher\";\n\nimport { createProxy, type ProxyOptions, type Proxy } from \"@src/Proxy\";\n\nconst useFetcher = (options: Options = {}): Proxy => {\n  const { key, cache, synchronizations, cleanFn } = options;\n\n  let fetcher: Interpreter;\n\n  if (cache !== undefined) {\n    if (cache.has(key)) {\n      fetcher = cache.get(key).fetcher;\n    } else {\n      fetcher = interpret(createFetcher(options));\n\n      cache.set(key, fetcher, options);\n    }\n\n    if (synchronizations !== undefined) {\n      const subscriptions = synchronizations.map<Subscription>(\n        (synchronization) => ({\n          ...synchronization,\n          subscribeFn: (parameters) => {\n            const synchronizationEvent = synchronization.synchronizeFn({\n              ...parameters,\n              fetcher,\n              cache,\n            });\n\n            if (synchronizationEvent !== undefined) {\n              fetcher.send(synchronizationEvent);\n            }\n          },\n        })\n      );\n\n      const unsubscribeFn = cache.subscribe(subscriptions);\n\n      options.cleanFn = () => {\n        if (cleanFn !== undefined) {\n          cleanFn();\n        }\n\n        unsubscribeFn();\n\n        cache.deactivate(key);\n      };\n\n      cache.activate(key);\n    }\n  } else {\n    fetcher = interpret(createFetcher(options));\n  }\n\n  return createProxy(fetcher, { ...options, autoStart: true });\n};\n\ntype Options = FetcherOptions &\n  CacheOptions &\n  Pick<ProxyOptions, \"mapFn\" | \"cleanFn\"> & {\n    key?: Key;\n    cache?: Cache;\n    synchronizations?: Synchronization[];\n  };\n\ntype Synchronization = Omit<Subscription, \"subscribeFn\"> & {\n  synchronizeFn: SynchronizeFn;\n};\n\ntype SynchronizeFn = (parameters: SynchronizeFnParameters) => Event | void;\n\ntype SynchronizeFnParameters = SubscribeFnParameters & {\n  fetcher: Interpreter;\n  cache: Cache;\n};\n\nexport {\n  useFetcher,\n  type Options,\n  type Synchronization,\n  type SynchronizeFn,\n  type SynchronizeFnParameters,\n};\n"],"names":["createCache","Cache","__publicField","key","fetcher","options","entryIndex","cacheTime","keepActive","entry","state","batchFn","subscriptions","subscription","subscriptionIndex","subscribeFnIndex","sourceKey","targetKey","isExact","sourceKeyKeys","targetKeyKeys","_a","subscriptionKey","subscribeFn","getLastEvent","createFetcher","createMachine","context","_event","meta","event","_b","_d","_c","actions","_e","_f","_g","_h","_i","_j","_k","_l","_m","_context","exports","t","s","i","n","p","__rest","e","__values","o","m","__read","r","ar","error","__spreadArray","to","from","pack","l","constants","STATE_DELIMITER","EMPTY_ACTIVITY_MAP","DEFAULT_GUARD_TYPE","TARGETLESS_KEY","environment","IS_PRODUCTION","_tslib","require$$0","require$$1","require$$2","keys","value","matchesState","parentStateId","childStateId","delimiter","parentStateValue","toStateValue","childStateValue","isString","getEventType","getActionType","action","isFunction","toStatePath","stateId","isArray","isStateLike","stateValue","pathToStateValue","statePath","marker","mapValues","collection","iteratee","result","collectionKeys","mapFilterValues","predicate","e_1","item","e_1_1","path","props","object","e_2","props_1","props_1_1","prop","e_2_1","nestedPath","accessorProp","e_3","props_2","props_2_1","e_3_1","toStatePaths","flatten","subStateValue","subPath","pathsToStateValue","paths","e_4","paths_1","paths_1_1","currentPath","e_4_1","array","toArrayStrict","toArray","mapContext","mapper","e_5","subMapper","e_5_1","isBuiltInEvent","eventType","isPromiseLike","isBehavior","partition","items","e_6","truthy","falsy","items_1","items_1_1","e_6_1","updateHistoryStates","hist","subHist","updateHistoryValue","updateContext","assignActions","updatedContext","acc","assignAction","e_7","assignment","partialUpdate","propAssignment","e_7_1","condition","message","args","toGuard","guardMap","isObservable","symbolObservable","interopSymbols","isMachine","isActor","uniqueId","currentId","toEventObject","payload","toSCXMLEvent","scxmlEvent","eventObject","toTransitionConfigArray","configLike","transitions","transitionLike","normalizeTarget","target","reportUnhandledExceptionOnInvocation","originalError","currentError","id","originalStackTrace","stackTrace","evaluateGuard","machine","guard","guards","guardMeta","condFn","toInvokeSource","src","toObserver","nextHandler","errorHandler","completionHandler","noop","isObserver","self","createInvokeId","stateNodeId","index","interceptor","createProxy","machineOrInterpreter","proxy","sendBack","on","interpreter","interpret","mapFn","autoStart","autoStop","cleanFn","interpreterUnsubscribeFn","interceptorUnsubscribeFn","isInterceptorInitialized","mappedEvent","useFetcher","cache","synchronizations","synchronization","parameters","synchronizationEvent","unsubscribeFn"],"mappings":"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"}